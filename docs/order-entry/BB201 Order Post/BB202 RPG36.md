### Process Steps of the RPG Program (BB202.rpg36.txt)

This RPG III program (BB202) processes order transaction headers from a batch file (BBORTR) to check for orders placed on credit hold during posting. If an order is newly on hold and unauthorized, it generates output reports (as spool files) for emailing notifications to relevant parties (e.g., CSR, salesman, credit manager). The program reads sequentially, performs lookups, calculates dates, and applies conditional logic for notifications. It ignores deleted orders and focuses on credit hold changes. The process is executed in a loop for each qualifying header record.

High-level process steps:

1. **Initialization and Date Setup**:
   - On first pass (ONCE = 0), captures system time (TIMDAT) and date (UDATE), breaking them into SYSTIM, SYSDAT, YMD, CYR.
   - Handles Y2K century rollover: If year >= Y2KCMP (likely 2000), sets CN to Y2KCEN (19); else adds 1 to Y2KCEN (20).
   - Converts dates to CYMD (SYCYMD) and MDY formats.
   - Calls subroutine @DTE1 to convert Gregorian date ($MDY, $CN) to Julian (G$JD) and day of week (G$JW).
   - Calculates days from current date to requested date (BORQDT) for display.
   - Initializes zeros for accumulators (Z92, Z2, ZERO6, ZERO8) and increments ONCE.

2. **Header Record Processing (L2 DO Loop)**:
   - Chains to BICONT using company (BOCO) for company info.
   - Sets keys (OKEY8, COCUST) for further lookups.
   - Resets totals (L2TOTL = 0).

3. **Skip Deleted Orders**:
   - If BODEL = 'D' (delete flag), skips processing (per JB01/JB02 revisions to ignore deleted orders).

4. **Subroutine HDR (Main Processing)**:
   - Sets indicators (10 for process order, 72 on).
   - Checks order type: Sets 26/27 if BOTYPE = 'R' (return/credit invoice?).
   - Chains to ARCUST using customer (BOCUST/COCUST) for customer details (name, address, aging balances, credit limit).
   - Builds keys (KEY14, ORCLKY) for BBORCL chain.
   - Looks up CSR email (EDICU) from BBCSR using company + order taken by (BOTKBY); defaults to 'SJM' if not found.
   - Looks up salesman email (EDISM) from BBSLSM using company + salesman (BOSLMN).
   - Looks up A/R clerk email (EDIAR) from BBCSR using company + authorization initials (BLAUIN).
   - Chains to BBORCL using order key (company + customer + order#) to get credit hold details.
   - Calculates order amount (ORDAMT): Prioritizes BLOAMT (order file amount) if non-zero; falls back to BLTAMT (transaction amount).
   - Checks for credit hold change: If BLOVCL (current hold Y/N) == BLOVSV (saved hold), skips notification (TAG SKIP).
   - Removed check for days >= 21 (MG01; previously skipped notifications for far-future orders).
   - If not in BBORCL (N98), unauthorized (BLAUIN blank), and on hold (BLOVCL = 'Y'), executes exception output (EXCPT UNAU) to generate notification reports.
   - Tags SKIP and executes EXCPT RESET to clear.

5. **Date Conversion Subroutine (@DTE1)**:
   - Breaks $MDY into month/day/year.
   - Handles century if not provided (similar to init).
   - Converts Gregorian to Julian: Adjusts month/year, calculates days using formulas (e.g., month * 30.6, year * 365.25).
   - Determines day of week via modulo 7.

6. **Output and End**:
   - Exception records (UNAU) written to CREMAL and SMEMAL (printer files, likely spooled for email).
   - Outputs include: Timestamp, order/customer details, addresses, pickup date/days away, amounts, credit limit, payment dates, aging buckets (current, 1-30, 31-60, etc.), notify emails.
   - Resets BBORCL record with blanks in positions 89+.
   - Ends when end-of-file on BBORTR.

### Business Rules

- **Deleted Orders**: Skipped entirely (BODEL != 'D'; revisions JB01/JB02 to refine ignoring deletes).
- **Order Types**: Flags 'R' as credit invoice (ind 26/27), but processes all non-deleted.
- **Credit Hold Notification**:
  - Triggered only if hold status changed (BLOVCL != BLOVSV; i.e., newly on hold during batch).
  - Requires unauthorized (BLAUIN blank) and active hold (BLOVCL = 'Y').
  - No longer limited to <21 days from request date (removed per MG01).
- **Order Amount**: Uses BLOAMT if available; falls back to BLTAMT; sums if both present (handles discrepancies between transaction and order files).
- **Emails/Notifications**:
  - Sent to CSR (from BBCSR via BOTKBY), Salesman (from BBSLSM via BOSLMN), A/R Clerk (from BBCSR via BLAUIN).
  - Defaults CSR to 'SJM' if not found.
  - Fixed notifies in output: bzolkos@amref.com, lmidla@amref.com (likely credit team).
  - Dual outputs (CREMAL for credit, SMEMAL for salesman) with identical content.
- **Dates**: Handles Y2K, calculates days to request date for urgency display.
- **Customer Aging**: Displays balances (total due, current, overdues in buckets) from ARCUST.
- **Credit Limit**: Compared implicitly via hold, displayed in notification.

### Tables Used (Files)

Files are disk or printer, with keyed access (AI for alternate index).

- **BBORTR**: Input primary (IP) - Order transaction batch (headers).
- **BICONT**: Input combined (IC) - Company/container info.
- **BBORCL**: Update (UF) - Order credit hold log.
- **ARCUST**: Input combined (IC) - A/R customer master (aging, limits).
- **BBCSR**: Input (IF) - CSR (customer service rep) table (emails).
- **BBSLSM**: Input (IF) - Salesman table (emails).
- **CREMAL**: Output (O) - Printer/spool for credit manager email notifications.
- **SMEMAL**: Output (O) - Printer/spool for salesman email notifications.

### External Programs Called

None. This program does not call any external programs (no CALL opcodes).