The provided document is a **Control Language Program (CLP)** named `AR418TC.clp.txt`, which is called conditionally from the `AR418.ocl36` OCL program when the parameter `?9?` equals `G`. This CLP program is responsible for sending email notifications to customer service representatives (CSRs) and salesmen when the credit hold status of an order changes. Below, I will explain the process steps, business rules, tables used, and external programs called .

---

### **Process Steps of the AR418TC.clp Program**

The CLP program automates the distribution of spooled files (reports) generated by the `AR418` RPGLE program, specifically for email notifications related to order credit status changes. Here’s a step-by-step breakdown of the process:

1. **Program Start**:
   - The program begins with the `PGM` command, indicating the start of the CLP program. No parameters are defined, suggesting it relies on the environment set up by the calling OCL program.

2. **Process Spooled File for CSR Notification**:
   - `SFASPLIT RSPNM('ORDER CREDIT STATUS') OUTQ(QUSRSYS/CSROUTQ) MVTOOUTQ(*DELETE)`:
     - Executes the `SFASPLIT` command to process a spooled file named `'ORDER CREDIT STATUS'`.
     - Directs the output to the `QUSRSYS/CSROUTQ` output queue, which is likely configured for CSR email notifications.
     - The `MVTOOUTQ(*DELETE)` parameter indicates that the spooled file is deleted after processing.
   - `MONMSG MSGID(SF00136)`:
     - Monitors for the error message `SF00136` (likely indicating the spooled file was not found or another error occurred during `SFASPLIT`).
     - If the error occurs, the program continues without interruption, ensuring robustness.

3. **Process Spooled File for Salesman Notification**:
   - `SFASPLIT RSPNM('ORDER CREDIT STATUS2') OUTQ(SLMNOUTQ) MVTOOUTQ(*DELETE)`:
     - Processes a spooled file named `'ORDER CREDIT STATUS2'`.
     - Directs the output to the `SLMNOUTQ` output queue, likely configured for salesman email notifications.
     - Deletes the spooled file after processing.
   - `MONMSG MSGID(SF00136)`:
     - Handles errors gracefully, allowing the program to continue if the spooled file is missing or an error occurs.

4. **Distribute CSR Notification**:
   - `SFARDST RDSNM('ORDER CREDIT STATUS')`:
     - Executes the `SFARDST` command to distribute the report data set named `'ORDER CREDIT STATUS'`.
     - This likely sends the CSR notification (from the `cremal` file in `AR418.rpgle`) via email, based on the email addresses stored in `bbcsr` (CSR email, `qqcrem`).
   - `MONMSG MSGID(SF00136)`:
     - Handles errors if the report data set is not found or distribution fails.

5. **Commented-Out Distribution for Salesman Notification**:
   - The lines:
     ```cl
     /* SFARDST RDSNM('ORDER CREDIT STATUS2') MVTOOUTQ(JUNKOUTQ) */
     /* MONMSG MSGID(SF00136) */
     ```
     are commented out, indicating they are not currently executed. If uncommented, they would distribute the `'ORDER CREDIT STATUS2'` report data set to the `JUNKOUTQ` output queue, likely for testing or debugging purposes.

6. **Distribute Additional Notification**:
   - `SFARDST RDSNM('ORDER CREDIT STATUS3') MVTOOUTQ(DLTOUTQ)`:
     - Distributes a report data set named `'ORDER CREDIT STATUS3'` to the `DLTOUTQ` output queue, with the spooled file deleted after processing.
     - This may correspond to an additional notification (possibly for a credit manager or another recipient).
   - `MONMSG MSGID(SF00136)`:
     - Handles errors if the report data set is not found or distribution fails.

7. **Program End**:
   - The `ENDPGM` command terminates the program after all commands are executed or errors are handled.

---

### **Business Rules**

1. **Email Notification Trigger**:
   - The program is executed only when the `?9?` parameter in the calling OCL program (`AR418.ocl36`) equals `G`, typically indicating a test or specific environment.
   - It processes spooled files generated by the `AR418` RPGLE program (`cremal` and `smemal`) to send email notifications when an order’s credit hold status changes (e.g., authorized, unauthorized, or placed on hold).

2. **Spooled File Management**:
   - Spooled files (`ORDER CREDIT STATUS`, `ORDER CREDIT STATUS2`, `ORDER CREDIT STATUS3`) are processed and deleted after distribution to prevent clutter in the output queues.
   - The program uses specific output queues (`QUSRSYS/CSROUTQ`, `SLMNOUTQ`, `DLTOUTQ`) to route notifications to the appropriate recipients (CSRs, salesmen, or others).

3. **Error Handling**:
   - The program is designed to be robust, using `MONMSG` to catch errors (`SF00136`) and continue execution, ensuring that a failure in one step does not halt the entire process.

4. **Recipient Targeting**:
   - Notifications are sent to:
     - CSRs via `QUSRSYS/CSROUTQ` (using `cremal` file data, with email addresses from `bbcsr`).
     - Salesmen via `SLMNOUTQ` (using `smemal` file data, with email addresses from `bbslsm`).
     - An additional recipient or process via `DLTOUTQ` (possibly for credit managers or archival purposes).

---

### **Tables (Files) Used**

The CLP program itself does not directly interact with database files (tables). Instead, it processes spooled files generated by the `AR418` RPGLE program. However, based on the context of the calling programs (`AR418.ocl36` and `AR418.rpgle`), the spooled files are derived from the following files:

1. **cremal**:
   - Type: Spooled file (printer file, 140 bytes).
   - Purpose: Contains CSR notification data, including order details, customer information, and credit status (e.g., "RELEASED FROM CREDIT HOLD" or "PLACED ON CREDIT HOLD").
   - Processed as `'ORDER CREDIT STATUS'` in `QUSRSYS/CSROUTQ`.

2. **smemal**:
   - Type: Spooled file (printer file, 140 bytes).
   - Purpose: Contains salesman notification data, similar to `cremal`.
   - Processed as `'ORDER CREDIT STATUS2'` in `SLMNOUTQ`.

3. **Unknown File for `'ORDER CREDIT STATUS3'`**:
   - Type: Spooled file (likely a printer file).
   - Purpose: Likely contains additional notification data, possibly for a credit manager or archival process, sent to `DLTOUTQ`.
   - Not explicitly defined in `AR418.rpgle`, suggesting it may be generated by another process or configuration.

No direct database files (e.g., `bicont`, `bborcl`, `bbcsr`, `bbslsm`, `arcust`, `gscont`) are accessed by `AR418TC.clp`. The data used in the spooled files originates from these files via the `AR418` RPGLE program.

---

### **External Programs Called**

The CLP program uses the following external commands, which are part of the IBM i (or System/36) operating system:

1. **SFASPLIT**:
   - Purpose: Splits or processes spooled files for distribution, likely part of a third-party or custom spooled file management tool (e.g., SpoolFlex, as mentioned in `AR418.rpgle` comments).
   - Used to process `'ORDER CREDIT STATUS'` and `'ORDER CREDIT STATUS2'` spooled files.

2. **SFARDST**:
   - Purpose: Distributes report data sets, likely converting spooled files into email notifications or other output formats.
   - Used to distribute `'ORDER CREDIT STATUS'` and `'ORDER CREDIT STATUS3'` (with `'ORDER CREDIT STATUS2'` commented out).

No additional user-defined programs are called directly by `AR418TC.clp`.

---

### **Summary**

The `AR418TC.clp` program is a lightweight CLP program called conditionally from `AR418.ocl36` to handle email notifications for order credit status changes. It:
- Processes spooled files (`cremal`, `smemal`, and an undefined file for `'ORDER CREDIT STATUS3'`) using `SFASPLIT` and `SFARDST`.
- Routes notifications to CSRs (`QUSRSYS/CSROUTQ`), salesmen (`SLMNOUTQ`), and potentially others (`DLTOUTQ`).
- Deletes spooled files after processing to maintain system cleanliness.
- Includes robust error handling to ensure uninterrupted execution.

The program relies on the output generated by `AR418.rpgle` and does not directly access database files or call other user programs, focusing solely on spooled file distribution.