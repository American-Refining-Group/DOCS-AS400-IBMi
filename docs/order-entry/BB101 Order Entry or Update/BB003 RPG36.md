The RPG program `BB003.rpg36.txt` is a utility program for an IBM System/38 or AS/400 (iSeries) system, called from the `BB101.ocl36.txt` OCL program. Its primary function is to delete records from specific order transaction files when a batch is deleted. The program targets records associated with a given company and order number, ensuring that all related data is removed from multiple files. Below, I will explain the process steps, business rules, tables (files) used, and external programs called, based on the provided RPG source and its annotations.

### Process Steps of the RPG Program

The program is designed to process records in a loop, identifying and deleting records from four transaction files based on a key (`TCOORD`, company/order number). The steps are as follows:

1. **Initialization**:
   - The program initializes by defining the input and update files (`BBORTR`, `BBORCL`, `BBOTHS1`, `BBOTDS1`, `BBOTA1`) and setting up a data structure (`BBKEY`) to hold the company (`TDCO`), customer (`TDCUST`), and order number (`TDORD#`).
   - The key `Tcoord` (company/order number) is extracted from the input file `BBORTR` to drive the deletion process.

2. **Main Processing Loop (Indicator 11)**:
   - The program enters a `DO` loop (controlled by indicator 11) to process records from the `BBORTR` file, which contains order transaction data.
   - For each record, the program performs deletion operations across four files:
     - **BBORCL (Order Transaction File)**:
       - Chains to `BBORCL` using the key `BBKEY` (company/customer/order number).
       - If a record is found (`N99`), it executes the `DELETE` exception output to delete the record.
     - **BBOTHS1 (Order Header Supplemental File)**:
       - Sets the file pointer to the first record matching `Tcoord` using `SETLL`.
       - Reads records in a loop (`RDAGN1`).
       - Compares the record’s company/order number (`BOCOOR`) with `Tcoord`.
       - If matched (`N99`), executes the `DELOTS` exception output to delete the record and continues reading until no more matching records are found.
     - **BBOTDS1 (Order Detail Supplemental File)**:
       - Moves `Tcoord` to a key field (`KL11`) and sets the file pointer using `SETLL`.
       - Reads records in a loop (`RDAGN2`).
       - Compares the record’s company/order number (`BDCOOR`) with `Tcoord`.
       - If matched (`N99`), executes the `DELOTD` exception output to delete the record and continues reading.
     - **BBOTA1 (Order Accessorial/Marks File)**:
       - Moves `Tcoord` to a key field (`KL13`) and sets the file pointer using `SETLL`.
       - Reads records in a loop (`RDAGN3`).
       - Compares the record’s company/order number (`BACOOR`) with `Tcoord`.
       - If matched (`N99`), executes the `DELOTA` exception output to delete the record and continues reading.
   - The loop ends after processing all relevant records for the given `Tcoord`.

3. **Output Exceptions**:
   - The program uses exception outputs to perform deletions:
     - `DELETE`: Deletes records from `BBORCL`.
     - `DELOTS`: Deletes records from `BBOTHS1`.
     - `DELOTD`: Deletes records from `BBOTDS1`.
     - `DELOTA`: Deletes records from `BBOTA1`.

### Business Rules

The program enforces the following business rules:

- **Targeted Deletion**:
  - Deletes records only for the specified company and order number (`Tcoord`) from the `BBORTR` input file.
  - Ensures that all related records in `BBORCL`, `BBOTHS1`, `BBOTDS1`, and `BBOTA1` are deleted when a batch is marked for deletion, maintaining data consistency across transaction files.

- **Key-Based Deletion**:
  - Uses the composite key `Tcoord` (company/order number) to identify records in `BBOTHS1`, `BBOTDS1`, and `BBOTA1`.
  - For `BBORCL`, uses `BBKEY` (company/customer/order number) to ensure precise deletion.

- **File Integrity**:
  - Checks for the existence of records before deletion (`N99` indicator) to avoid processing non-existent records.
  - Reads all matching records in supplemental files (`BBOTHS1`, `BBOTDS1`, `BBOTA1`) to ensure complete removal of related data.

- **Update Control**:
  - The `BBORCL`, `BBOTHS1`, `BBOTDS1`, and `BBOTA1` files are opened in update mode (`UC` or `UF`) to allow deletion operations.
  - The `EXTK` attribute on supplemental files indicates extended key processing, ensuring accurate record matching.

- **No User Interaction**:
  - The program operates without user input, relying on the `BBORTR` file to provide the records to process.
  - No error messages or user-facing outputs are defined, as the program is a backend utility triggered by batch deletion.

### Tables (Files) Used

The program uses the following files:
1. `BBORTR`: Input file (512 bytes, primary file) containing order transaction records with company, order number, customer, and delete code.
2. `BBORCL`: Update file (256 bytes, random access) for order transaction details, deleted using `BBKEY`.
3. `BBOTHS1`: Update file (512 bytes, extended key) for order header supplemental data, deleted based on `Tcoord`.
4. `BBOTDS1`: Update file (512 bytes, extended key) for order detail supplemental data, deleted based on `Tcoord`.
5. `BBOTA1`: Update file (512 bytes, extended key) for order accessorial/marks data, deleted based on `Tcoord`.

### External Programs Called

No external programs are called in `BB003.rpg36.txt`. The program performs all operations internally using file I/O and exception outputs.

### Summary

The `BB003.rpg36.txt` program is a focused utility that deletes records from order transaction files (`BBORCL`, `BBOTHS1`, `BBOTDS1`, `BBOTA1`) when a batch is deleted, as triggered by the `BB101.ocl36.txt` OCL program (specifically when `SWITCH1-1` is set). It processes records from the `BBORTR` input file, using company and order number keys to identify and remove related records across multiple files. The program enforces strict data consistency by ensuring all associated records are deleted, with no user interaction or external program dependencies. The addition of `BBOTHS1`, `BBOTDS1`, and `BBOTA1` deletion (per DC01, 03/10/10) enhances its scope to cover supplemental order data.