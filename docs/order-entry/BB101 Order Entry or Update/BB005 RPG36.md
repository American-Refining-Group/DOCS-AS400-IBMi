The RPG program `BB005.rpg36.txt` is a utility program for an IBM System/38 or AS/400 (iSeries) system, called from the `BB101.ocl36.txt` OCL program during the "Release Batch" phase. Its primary function is to update the status of a batch in the `BBBTCH` file based on the program mode (`PGM`), which determines whether the batch is released, marked for picking, marked for bill of lading (BOL) printing, or posted. Below, I will explain the process steps, business rules, tables (files) used, and external programs called, based on the provided RPG source.

### Process Steps of the RPG Program

The program is straightforward, focusing on updating the `BBBTCH` file based on the input batch number and program mode. The steps are as follows:

1. **Initialization**:
   - The program defines the `BBBTCH` file as an update file (`UC`, 48 bytes, random access with 2 access paths).
   - Retrieves input parameters from the User Data Structure (UDS):
     - `BATCH#`: The batch number to process (positions 490–491).
     - `PGM`: The program mode (position 504), indicating the action to perform ('O', 'L', 'B', or 'P').
     - `RECCNT`: The record count for the batch (positions 475–482).

2. **Batch Record Retrieval**:
   - Chains to the `BBBTCH` file using `BATCH#` to locate the batch record.
   - If the record is found (`N99`, indicator 99 off), proceeds with processing; otherwise, exits without action.

3. **Batch Status Update (Conditional Logic)**:
   - The program uses a nested `IF` structure to determine the action based on the `PGM` value:
     - **If `PGM='O'` (Order Entry)**:
       - Executes the `REL` exception output, setting:
         - Position 6 (lock status, `ABLOCK`) to blank (' ').
         - Position 8 (lock workstation ID, `ABLKWS`) to blank ('  ').
         - Position 39 (record count, `ABREC`) to `RECCNT`.
     - **If `PGM='L'` (Pick List)**:
       - Executes the `PICK` exception output, setting:
         - Position 6 (`ABLOCK`) to blank (' ').
         - Position 8 (`ABLKWS`) to blank ('  ').
         - Position 39 (`ABREC`) to `RECCNT`.
     - **If `PGM='B'` (Bill of Lading)**:
       - Executes the `BOL` exception output, setting:
         - Position 6 (`ABLOCK`) to blank (' ').
         - Position 8 (`ABLKWS`) to blank ('  ').
         - Position 9 (BOL printed flag, `ABPRTD`) to 'Y'.
         - Position 39 (`ABREC`) to `RECCNT`.
     - **If `PGM='P'` (Posting)**:
       - Executes the `POST` exception output, setting:
         - Position 1 (delete code, `ABDEL`) to 'D' (marking the batch as deleted).
         - Position 6 (`ABLOCK`) to 'P' (indicating posting status).
         - Position 39 (`ABREC`) to `RECCNT`.
     - **Default (if `PGM` is none of the above)**:
       - Executes the `REL` exception output, applying the same updates as for `PGM='O'`.

4. **Program Termination**:
   - Sets the Last Record (`LR`) indicator to exit the program after processing.

### Business Rules

The program enforces the following business rules:

- **Batch Status Updates**:
  - For Order Entry (`PGM='O'`), the batch is released by clearing the lock status (`ABLOCK`) and workstation ID (`ABLKWS`), and updating the record count (`ABREC`).
  - For Pick List (`PGM='L'`), the batch is similarly released, clearing locks to allow further processing.
  - For Bill of Lading (`PGM='B'`), the batch is released, and the BOL printed flag (`ABPRTD`) is set to 'Y', indicating that the BOL has been printed.
  - For Posting (`PGM='P'`), the batch is marked as deleted (`ABDEL='D'`) and set to posting status (`ABLOCK='P'`), with the record count updated.
  - If an invalid `PGM` value is provided, the batch is released as if in Order Entry mode.

- **Record Existence**:
  - The program only processes batches that exist in the `BBBTCH` file (`N99`). If the batch is not found, no action is taken.

- **Data Consistency**:
  - The record count (`RECCNT`) is consistently updated in position 39 of the `BBBTCH` file for all actions.
  - Lock status and workstation ID are cleared for most actions, except for posting, where the lock status is set to 'P'.

- **No User Interaction**:
  - The program operates as a backend utility, relying on input parameters (`BATCH#`, `PGM`, `RECCNT`) from the calling OCL program without user input or screen displays.

### Tables (Files) Used

The program uses the following file:
1. `BBBTCH`: Batch master file (update, 48 bytes, random access with 2 access paths), used to store and update batch status, lock information, and record count.

### External Programs Called

No external programs are called in `BB005.rpg36.txt`. All processing is handled internally through file updates and exception outputs.

### Summary

The `BB005.rpg36.txt` program is a simple utility called from the `BB101.ocl36.txt` OCL program to manage batch status updates in the `BBBTCH` file. It processes a specified batch number based on the program mode (`PGM`), releasing the batch, marking it for picking or BOL printing, or posting it as deleted. The program enforces strict rules for updating batch status and ensures data consistency by updating the record count and clearing locks appropriately. It uses only the `BBBTCH` file and does not call external programs, making it a focused backend component of the order entry batch processing system.