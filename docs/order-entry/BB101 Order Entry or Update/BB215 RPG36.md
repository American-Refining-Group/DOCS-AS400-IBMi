The RPG program `BB215.rpg36.txt` is a utility program for an IBM System/38 or AS/400 (iSeries) system, called from the `BB101.ocl36.txt` OCL program when `SWITCH1-1` is set (indicating batch deletion). Its primary function is to remove lockout conditions from order header records in the `BBORDRH` file by clearing lock-related fields for a specified company and order number. Below, I will explain the process steps, business rules, tables (files) used, and external programs called, based on the provided RPG source.

### Process Steps of the RPG Program

The program is a concise backend utility that processes order transaction records to clear lockout fields. The steps are as follows:

1. **Initialization (ONCE Logic)**:
   - Checks if the `ONCE` variable (a 1-digit field initialized to 0) is zero.
   - If true (`ONCE=*ZERO`):
     - Clears the `LOCK` field (1 byte) to blanks.
     - Clears the `WSID` field (2 bytes) to blanks.
     - Sets `ONCE` to 1 to prevent re-execution of this block.
   - This ensures that initialization occurs only once during program execution.

2. **Processing Order Transaction Records**:
   - Reads records from the primary input file `BBORTR` (order transaction file) using indicator 01.
   - For each record, extracts the company/order number key (`BOCOS`, positions 2â€“12).
   - Chains to the `BBORDRH` file (order header file) using `BOCOS` to locate the corresponding header record.
   - If the header record is found (`N90`, indicator 90 off), updates the record by writing to the `BBORDRH` file with:
     - `LOCK` (position 155) set to blanks.
     - `WSID` (position 157) set to blanks.

3. **Output Operation**:
   - The `D` (detail) output specification conditionally updates `BBORDRH` when indicator 01 is on (record read from `BBORTR`) and indicator 90 is off (record found in `BBORDRH`).
   - Updates only the `LOCK` and `WSID` fields to clear lockout conditions.

### Business Rules

The program enforces the following business rules:

- **Lock Removal**:
  - Clears the lock status (`LOCK`) and workstation ID (`WSID`) fields in the `BBORDRH` file for the specified company and order number (`BOCOS`) derived from `BBORTR`.
  - This action removes any lockout conditions that prevent the order from being processed further, typically as part of batch deletion.

- **Conditional Update**:
  - Updates only records that exist in `BBORDRH` (`N90`).
  - Processes only records read from `BBORTR` (indicator 01), ensuring that only relevant orders are affected.

- **Single Execution of Initialization**:
  - The `ONCE` flag ensures that initialization (clearing `LOCK` and `WSID` variables) occurs only once, preventing redundant processing.

- **No User Interaction**:
  - The program operates as a backend utility without user input or screen displays, relying on the `BBORTR` file to provide the records to process.

### Tables (Files) Used

The program uses the following files:
1. `BBORTR`: Primary input file (512 bytes, sequential access) containing order transaction records with company and order number (`BOCOS`).
2. `BBORDRH`: Update file (512 bytes, random access with 2 access paths) containing order header records, updated to clear lock status (`LOCK`) and workstation ID (`WSID`).

### External Programs Called

No external programs are called in `BB215.rpg36.txt`. All processing is handled internally through file I/O and output operations.

### Summary

The `BB215.rpg36.txt` program is a lightweight utility called from the `BB101.ocl36.txt` OCL program to remove lockout conditions from order header records in `BBORDRH` during batch deletion. It reads order transaction records from `BBORTR`, locates corresponding header records using the company/order number key (`BOCOS`), and clears the `LOCK` and `WSID` fields to release the orders. The program enforces strict rules to update only existing records and performs initialization once to ensure efficiency. It uses two files (`BBORTR`, `BBORDRH`) and does not call external programs, making it a focused component of the batch deletion process in the order entry system.