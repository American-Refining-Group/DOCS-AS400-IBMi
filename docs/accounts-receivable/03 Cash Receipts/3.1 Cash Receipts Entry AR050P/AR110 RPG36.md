The `AR110.rpg36.txt` program is an RPG II program (with System/36 syntax) designed for editing and validating individual cash receipts transactions in an accounts receivable (AR) system. It is invoked by the `AR110.ocl36` OCL script, which prepares the environment by sorting transactions, cleaning invalid records, and defining necessary files. The program validates transactions entered via `AR100`, produces edit reports, and generates Notices of Difference (NODs) for discrepancies. It includes modifications to handle inactive GL accounts as deleted (JB01, 08/24/2016) and to add a total cash received by invoice column (MG02, 06/13/2022). Below, I outline the process steps, business rules, tables (files) used, and external programs called, based on the provided code and context from the OCL script.

### Process Steps of the AR110 RPG Program

1. **Initialization**:
   - **Program Setup**: The program defines files and initializes variables for processing transactions. It uses the `NODPRM` data structure to hold customer, company, invoice, and sales data for NOD reports.
   - **Key Fields**: Initializes fields like `ATCO` (company number), `ATCUST` (customer number), `ATINV#` (invoice number), and others from `CRTRAN` and `CR110S` (sorted transaction file).

2. **Read Sorted Transaction File (`CR110S`)**:
   - Reads records from `CR110S` (sorted by company and sequence number, excluding deleted records and non-payment types, as defined in the OCL sort).
   - Checks for level breaks (`L1`, `L3`, `L4`) on sequence (`ATKEY`), customer (`ATCUST`), and company (`ATCO`) to control report formatting and totals calculation.

3. **Validate Transaction Data**:
   - **Customer Validation**:
     - Chains to `ARCUST` using `ATCUST` to verify the customer exists and is not deleted (`ARDEL <> 'D'`).
     - Retrieves customer details: name (`ARNAME`), address (`ARADR1`–`ARADR4`), salesman number (`ARSLS#`).
   - **Invoice Validation**:
     - Chains to `ARDETL` using the composite key `ATCOCU` (company + customer) and `ATINV#` to verify the invoice exists and is not deleted (`ADDEL <> 'D'`).
     - Retrieves invoice details: amount (`ADAMT`), partial payment (`ADPART`), payment (`ADPAY`), due date (`ATDUDT`), terms (`ATTERM`).
   - **GL Account Validation**:
     - Chains to `GLMAST` for credit (`ATGLCR`), debit (`ATGLDR`), and discount (if applicable) GL accounts.
     - Checks `GLDEL`: Treats inactive accounts (`'I'`) the same as deleted (`'D'`) per JB01 update (08/24/2016).
     - If invalid, marks the transaction with an error (`'E'` in position 54 of `CRTRAN`).
   - **Check Validation**:
     - Chains to `CRCHKS` using `ATCKNO` (check number) to retrieve check amount (`CRCKAM`).
   - **Control File Check**:
     - Chains to `ARCONT` using `ATCO` to get company name (`ACNAME`) and default GL accounts (`ACARGL`, `ACCSGL`).
   - **System Table Check**:
     - Chains to `GSTABL` for additional configuration data (e.g., table description `TBDESC`).

4. **Error Handling**:
   - If validation fails (e.g., invalid customer, invoice, or GL account), updates `CRTRAN` with an error flag (`'E'` in position 54) via output operation `O CRTRAN D 01`.
   - If valid, clears the error flag (`' '` in position 54).

5. **Totals Calculation**:
   - Accumulates totals for reports:
     - `TOTAMT`: Total transaction amount (`ATAMT`).
     - `TOTDIS`: Total discount amount (`ATDISC`).
     - `TOTCAS`: Total cash received by invoice (added per MG02, 06/13/2022, calculated from `ATAMT` + `ATDISC`).
     - `TOTARC`: Total AR impact (likely `ATAMT` - `ATDISC`).
     - `TOTMIS`: Total miscellaneous cash (transactions without invoices).
     - `NETCHG`: Net change to AR (calculated at last record, `LR`).
   - Outputs totals at level breaks (`L1`, `L3`, `L4`) or end of job (`LR`).

6. **Edit Report Generation (`PRINT`)**:
   - Outputs to `PRINT` (164-byte printer file) with formatted transaction details:
     - Fields: `ATCO`, `ATCUST`, `ATINV#`, `ATAMT`, `ATDISC`, `ATTYPE`, `ATDATE`, `ATGLCR`, `ATGLDR`, `ATDESCL2`, `ATDUDT`, `ATTERM`, `ATSLS`, `ATCOCR`, `ATCODR`, `ATNOD`.
     - Totals: `TOTAMT`, `TOTDIS`, `TOTCAS`, `TOTARC`, `TOTMIS`, `NETCHG`.
   - Includes headers, footers, and separators (e.g., `'* * *'` at `LR`).

7. **Notice of Difference (NOD) Report (`NODLIST`)**:
   - Generates NOD reports for transactions with discrepancies (`ATNOD = 'Y'`) to `NODLIST` (164-byte printer file).
   - Content includes:
     - Company name (`ACNAME`).
     - Header: "NOTICE OF DIFFERENCE" and "(NOD)".
     - Sales engineer name (`SLNAME`) and transaction date (`ATDATEY`).
     - Customer details: number (`ATCUST`), name (`ARNAME`), address (`ARADR1`–`ARADR4`).
     - Ship-to number (`PSHIP`) and invoice number (`ATINV#`).
     - Invoice date (`INVDATY`), check number (`ATDESC`), check amount (`CRCKAMJ`).
     - Discrepancy amount (`ARBALNJ`) with "SHORTPAY" or "OVERPAY" flags.
     - Instructions for approval (sales manager, vice president, president) for adjustments over $2,500.
     - Permanent record notice for the customer credit file.

8. **File Updates**:
   - Updates `CRTRAN` to mark transactions as valid (`' '`) or erroneous (`'E'`).
   - Does not directly update `ARDETL` or `GLMAST` but validates against them.

9. **Program Termination**:
   - At last record (`LR`), outputs final totals and report footers (e.g., "NET CHANGE TO A/R", `NETCHG`).
   - Closes files and terminates.

### Business Rules

1. **Transaction Validation**:
   - Customers must exist in `ARCUST` and not be deleted (`ARDEL <> 'D'`).
   - Invoices must exist in `ARDETL` and not be deleted (`ADDEL <> 'D'`).
   - GL accounts (`ATGLCR`, `ATGLDR`) must exist in `GLMAST`, not deleted (`GLDEL <> 'D'`), and not inactive (`GLDEL <> 'I'`) per JB01.
   - Invalid transactions are flagged with `'E'` in `CRTRAN`.

2. **Transaction Type**:
   - Processes only payment transactions (`ATTYPE = 'P'`, enforced by OCL sort).
   - Miscellaneous cash (no invoice) is identified and included in `TOTMIS`.

3. **Notice of Difference (NOD)**:
   - Generated when `ATNOD = 'Y'` (notification of difference).
   - Requires discrepancy amount (`ARBALNJ`) to be classified as "SHORTPAY" or "OVERPAY".
   - Adjustments over $2,500 require president approval; NODs become permanent records in the customer credit file.
   - Includes instructions for returning to the AR clerk in Pittsburgh.

4. **Totals Tracking**:
   - Tracks total amount (`TOTAMT`), discount (`TOTDIS`), cash received by invoice (`TOTCAS`, per MG02), AR impact (`TOTARC`), miscellaneous cash (`TOTMIS`), and net AR change (`NETCHG`).
   - Outputs totals at company, customer, and job-end breaks.

5. **Error Handling**:
   - Invalid data (customer, invoice, GL account) flags transactions for correction.
   - No direct updates to `ARDETL` or `GLMAST` during editing; errors are marked in `CRTRAN` for later correction.

6. **Atrium Compatibility**:
   - Uses `GG` suffix for files (`CRIEGG`, `CR10GG`, `CRICGG`) to align with Atrium environment (JB01, 11/28/23).

7. **Multi-User Support**:
   - Files are accessed in shared mode (`DISP-SHR` or `DISP-SHRMM` in OCL), allowing concurrent access without locking.

### Tables (Files) Used

1. **CR110S**:
   - Type: Input file (`IR`), disk-based, indexed temporary (`IT`).
   - Record Length: 3 bytes (likely a typo in source; should be 256 bytes per `CRTRAN`).
   - Usage: Sorted transaction file (from OCL `#GSORT`), read sequentially for validation.

2. **CRTRAN**:
   - Type: Update file (`UP`), disk-based.
   - Record Length: 256 bytes.
   - Key: 5-byte sequence number (`ATKEY`, positions 2-6).
   - Usage: Original transaction file, updated with error flags (`'E'` or `' '`).

3. **ARDETL**:
   - Type: Input file (`IF`), disk-based.
   - Record Length: 128 bytes.
   - Key: 18-byte key (company + customer + invoice).
   - Usage: Validates invoice details (e.g., `ADAMT`, `ADPAY`, `ADPART`, `ATDUDT`).

4. **ARCUST**:
   - Type: Input file (`IF`), disk-based.
   - Record Length: 384 bytes.
   - Key: 8-byte customer key.
   - Usage: Validates customer data (e.g., `ARNAME`, `ARADR1`–`ARADR4`, `ARSLS#`).

5. **GLMAST**:
   - Type: Input file (`IF`), disk-based.
   - Record Length: 256 bytes.
   - Key: 11-byte GL key (company + account).
   - Usage: Validates GL accounts (`ATGLCR`, `ATGLDR`); checks `GLDEL`.

6. **ARCONT**:
   - Type: Input file (`IF`), disk-based.
   - Record Length: 256 bytes.
   - Key: 2-byte company key.
   - Usage: Provides company name (`ACNAME`) and default GL accounts (`ACARGL`, `ACCSGL`).

7. **GSTABL**:
   - Type: Input file (`IF`), disk-based.
   - Record Length: 256 bytes.
   - Key: 12-byte key.
   - Usage: Configuration data (e.g., `TBDESC`).

8. **CRCHKS**:
   - Type: Input file (`IF`), disk-based.
   - Record Length: 96 bytes.
   - Key: 14-byte key (likely customer + check number).
   - Usage: Validates check amount (`CRCKAM`).

9. **PRINT**:
   - Type: Output file (`O`), printer.
   - Record Length: 164 bytes.
   - Usage: Generates edit listing with transaction details and totals.

10. **NODLIST**:
    - Type: Output file (`O`), line printer (`LPRINTER`).
    - Record Length: 164 bytes.
    - Usage: Prints NOD reports for discrepancies (`ATNOD = 'Y'`).

### External Programs Called

The `AR110` program does not explicitly call external programs within the provided code, but the OCL script indicates:
1. **AR1101**:
   - Implied by the OCL file definitions (`GSPROD`, `NODPRINT`), likely called by `AR110` for additional processing (e.g., generating further reports).
   - Purpose: Handles post-validation tasks, possibly updating ledgers or producing detailed outputs.

No other external calls are evident in the RPG code, which focuses on validation and reporting.

### Summary

The `AR110` program validates individual cash receipts from `AR100`, ensuring customers, invoices, and GL accounts are valid before posting. It:
- Reads sorted transactions (`CR110S`), validates against master files (`ARCUST`, `ARDETL`, `GLMAST`), and flags errors in `CRTRAN`.
- Generates edit reports (`PRINT`) with totals (including cash received by invoice per MG02) and NOD reports (`NODLIST`) for discrepancies requiring approval.
- Enforces rules for valid data, inactive GL handling (JB01), and discrepancy documentation.
- Integrates with the OCL script for sorted input, file cleanup, and Atrium compatibility.

The program supports a multi-user AR system with shared file access, producing critical validation outputs for the cash receipts workflow.